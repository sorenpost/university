#+TITLE: Metrics, figures, and code
#+AUTHOR: SÃ¸ren Post
#+Options: toc:nil
#+LATEX_HEADER: \setlength{\parskip}{1em} % set spaces between paragraphs to 1 character
#+LATEX_HEADER: \setlength{\parindent}{0em} % set indents for new paragraphs to 0
#+LATEX_HEADER: \usepackage{natbib}
#+LATEX_HEADER: \usepackage[a4paper, total={6in, 8in}]{geometry}
#+LATEX_HEADER: \newcommand{\vect}[1]{\boldsymbol{#1}}


This document presents and explains the metrics and figures used in the project. For each metric or figure there is a description and a walk-through of the code. 

* Metrics [0/7]
** TODO Revealed Comparative Advantage
*** Description
 The economy of the US is around 19 trillions USD in 2019. This is approximately 400 times the size of the economy of Ghana. To meaningfully compare which products different economies specialize in, some normalization procedure is necessary. For this I use the Revealed Comparative Advantage (also known as the Balassa Index). Originally introduced by cite:balassa_trade_1965.

  RCA compares the share of a products export value in a regions total export to the share of the products global export value in the total global exports. More formally:

  $$ RCA_{pc} = \frac{ x_{cp} }{ \sum_{p} x_{cp} } \bigg/ \frac{ \sum_{c} x_{cp} }{ \sum_{c} \sum_{p} x_{cp}} $$

  where $x_{cp}$ is the export value of product $p$ in country $c$ in a given year. If RCA is at 1 or above, a comparative advantage is considered revealed.

*** Coding
Calculating RCA is fairly simple. If the matrix $X$ contains export values with countries in rows and products in columns, we can use some matrix multiplication to get an RCA-matrix instead. 

TODO For data I use the cleaned trade data in SITC rev. 2 format (four digit). I only use data for the year 2010.

TODO:
    #+begin_src R 
      library(tidyverse)
      library(vroom)
      ## read data
      path <- "~/sorensfolder/sbpdata/data/sitc-rev2_tidy.csv"
      trade <- vroom(path) %>%
        filter(time == 2010) %>%
        select(-rca)
    #+end_src

First, I build the country-product matrix, where the elements are the export-value in constant dollars. This matrix is the $X$ matrix. Each element $x_{cp}$ is the intensity, i.e. the export value, of the country-product pair.

    #+begin_src R 
      mat <- spread(trade, key = unit, value = intensity) %>%
        select(-time) %>%
        column_to_rownames(var = "region") %>%
        as.matrix()
    #+end_src

Following the above definition of RCA, we need four elements: 
1. The matrix of individual country-product intensities. This is individual elements in $X$.
2. A vector of the total export from each country. This is the row sums of $X$.
3. A vector of the total export of a each product (by all countries). This is the column sums of $X$.
4. The total global export. This is the full sum of all elements in $X$.

We can represent the calculation in three steps. 

#+CAPTION: Depiction of the RCA calculation.
#+LABEL: fig:RCA_standard_formula
[[./figs/pngs/RCA_standard_formula.png]]

First we find the share of each product (A) in the country's total exports (B). This is represented by part 1 in figure [[fig:RCA_standard_formula]]. 

 #+begin_src R
   share_unit_region <- mat / rowSums(mat)
 #+end_src

~rowSums~ sums the product export values for each country. This results in a vector with each country's total export value. This is then divided into the intensity matrix, element-wise. It is repeated column by column, meaning that each product is divided by respective country's total export. 

The result of part 1 is a matrix, where each element is the share of the product in the countries total exports.

Second I find the share of each products total export value (C) in the total value of global exports (D). This is part 2 in figure [[fig:RCA_standard_formula]]. 
 
#+begin_src R
   share_unit_global <- colSums(mat) / sum(mat)
 #+end_src

 This is essentially the same procedure as before, but with the column sums (a vector containing the total value of a products exports over all countries) divided by a vector (global exports). The result is vector, where each element $i$ is product $i$'s total global export divided by all products total export.

Finally, I divide the outcome of part 1 with the outcome of part two. This is essentially that same idea as step one. I transpose the matrix from part 1 in order for R to divide the vector from part two element-wise, one column at a time. Finally I transpose the result to get the country-product format for the RCA matrix.

** TODO Revealed Comparative Advantage per capita
*** Description


*** Coding
** TODO Product-product similarity
*** Description
*** Coding
** TODO Country-product density
*** Description
*** Coding
** TODO Country coherence
*** Description
*** Coding
** TODO New products
*** Description
*** Coding
** TODO Fitness algorithm
*** Description
*** Coding
* Figures [0/0]
** Product Space graph
** Distribution of RCA
** Distribution of complexity 
** Distribution of degrees (sum of product proximities)

  bibliography:SGED07.bib
  bibliographystyle:humannat
